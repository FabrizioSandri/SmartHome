<html>
    <head>
        <title>Casa {{ vars["house_name"] }}</title>
        
        <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" crossorigin="anonymous"></script>
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" crossorigin="anonymous"></script>
                 
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">    
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.7.0/css/all.css" integrity="sha384-lZN37f5QGtY3VHgisS14W3ExzMWZxybE1SJSEsQp9S+oqd12jhcu+A56Ebc1zFSJ" crossorigin="anonymous">
        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/navbar.css') }}">
        <link rel= "stylesheet" type= "text/css" href= "{{ url_for('static',filename='css/surveillance.css') }}">

        <meta name="viewport" content="width=device-width, initial-scale=1">

        <script>
            
            function generateCameraSelector(id) {
                camerasJson = JSON.parse( {{ cameras | tojson | safe }} )

                selectCamera = document.getElementById(`cameras${id}`);

                camerasJson.forEach((camera) => {
                    let optionCamera = document.createElement("option");
                    optionCamera.setAttribute("value", "" + camera);
                    optionCamera.innerText = camera;
                    
                    selectCamera.appendChild(optionCamera);
                });
                    
                
                
            }

            function switchCamera(id) {
                console.log(`camera${id}`)
                cameraView = document.getElementById(`camera${id}`);
                newCameraid = document.getElementById(`cameras${id}`).value;
                
                console.log(`/surveillance/video_feed?cameraid=${newCameraid}`)
                cameraView.setAttribute("src", `/surveillance/video_feed?cameraid=${newCameraid}`)
            }

            /**
             * Dynamically generate the camera layout with a total of "numCameras" cameras
             */
            function generateCameraLayout(numCameras){
                let containerDiv = document.getElementById("mainContainer");


                for (let id = 0; id < numCameras; id++) {
                    let row1Div = document.createElement("div");
                    let row2Div = document.createElement("div");

                    row1Div.classList.add("row", "justify-content-center");
                    row2Div.classList.add("row", "justify-content-center");

                    let selectCamera = document.createElement("select");
                    selectCamera.id = `cameras${id}`;

                    let btnView = document.createElement("button");
                    btnView.innerText = "Seleziona";
                    btnView.onclick = () => switchCamera(id);
                    btnView.classList.add("btn", "btn-secondary");

                    let cameraView = document.createElement("img");
                    cameraView.id = `camera${id}`;
                    cameraView.src = "";
                    cameraView.alt = "";
                    cameraView.classList.add("cameraview");
                    cameraView.onerror = () => cameraView.src='static/empty.png';

                    containerDiv.appendChild(row1Div);
                    containerDiv.appendChild(row2Div);
                    row1Div.appendChild(selectCamera);
                    row1Div.appendChild(btnView);
                    row2Div.appendChild(cameraView);


                    generateCameraSelector(id);
                }
                

            }

        </script>
    </head>
    <body>
        <!-- Nav Bar -->
        {% include "navBar.html" %}
        
        <!-- Main container -->
        <div class="container-fluid" id="mainContainer">
      
        </div>

        <script>
            generateCameraLayout(1);
        </script>

    </body>
</html>

